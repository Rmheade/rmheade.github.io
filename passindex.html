<!DOCTYPE html>
<html>
    <script>
        // Prevent direct access - only allow iframe loading
        if (window.self === window.top) {
            window.location.href = '/';
        }
    </script>
   <head>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
      <title>StudyBuddy - Personal Study Tool</title>
      <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
      <meta charset="UTF-8">
      <meta name="author" content="HimeSpider">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <style>@import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap");
         :root {
         --bg: #f6f8fb;
         --card: #ffffff;
         --muted: #6b7280;
         --accent: #2563eb;
         --accent-purple: #7c3aed;
         --radius: 12px;
         --text: #0f172a;
         }
         [data-theme="dark"] {
         --bg: #0f172a;
         --card: #1e293b;
         --muted: #94a3b8;
         --text: #f1f5f9;
         }
         body {
         background: linear-gradient(180deg, var(--bg), var(--bg));
         color: var(--text);
         font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
         margin: 0;
         overflow: auto;
         min-height: 100vh;
         transition: background 0.3s, color 0.3s;
         }
         #top-header {
         align-items: flex-start;
         background: transparent;
         box-sizing: border-box;
         display: flex;
         justify-content: center;
         left: 0;
         padding: 18px 20px;
         position: fixed;
         top: 0;
         transition: background 0.3s ease, box-shadow 0.3s ease;
         width: 100%;
         z-index: 2;
         min-height: 120px;
         }
         #top-header.scrolled {
         background: rgba(255, 255, 255, 0.95);
         box-shadow: 0 6px 22px rgba(16, 24, 40, 0.06);
         }
         [data-theme="dark"] #top-header.scrolled {
         background: rgba(30, 41, 59, 0.95);
         }
         #top-header h1 {
         color: var(--accent);
         font-family: Inter, system-ui;
         font-size: 56px;
         font-weight: 800;
         margin: 0 auto;
         letter-spacing: -0.5px;
         }

         @media (max-width: 1024px) {
         #top-header h1 {
             font-size: 44px;
         }
         }

         @media (max-width: 768px) {
         #top-header h1 {
             font-size: 32px;
         }
         }
         .header-left .updates-box {
         background: var(--card);
         border: 1px solid #e6e9ef;
         border-radius: 12px;
         box-shadow: 0 6px 22px rgba(16, 24, 40, 0.06);
         color: var(--accent);
         font-family: Inter, sans-serif;
         left: 10px;
         min-width: 180px;
         padding: 12px 14px;
         position: absolute;
         top: 10px;
         z-index: 3;
         transition: background 0.3s, border 0.3s;
         }
         [data-theme="dark"] .header-left .updates-box {
         border-color: #334155;
         }
         .header-left .updates-box h2 {
         font-size: 14px;
         font-weight: 600;
         margin: 0 0 8px 0;
         color: var(--accent);
         }
         .header-left .updates-box ul {
         list-style: none;
         padding: 0;
         margin: 0;
         font-size: 12px;
         color: var(--muted);
         }
         .header-left .updates-box li {
         margin: 4px 0;
         }
         .header-right {
         position: absolute;
         right: 20px;
         top: 18px;
         display: flex;
         flex-direction: column;
         gap: 8px;
         align-items: flex-end;
         }
         #search-container input {
         background: var(--card);
         border: 1px solid #e6e9ef;
         border-radius: 8px;
         color: var(--text);
         font-size: 0.9rem;
         outline: none;
         padding: 10px 12px;
         font-family: Inter, system-ui;
         transition: background 0.3s, border 0.3s, color 0.3s;
         }
         [data-theme="dark"] #search-container input {
         border-color: #334155;
         }
        [data-theme="dark"] #password-container input {
            border-color: #334155 !important;
        }
         #search-container input::placeholder {
         color: var(--muted);
         opacity: 0.7;
         }
         p {
         color: var(--text);
         font-family: Inter, system-ui;
         font-size: 1rem;
         margin-top: 5px;
         line-height: 1.5;
         transition: color 0.3s;
         }
         #intro {
         margin: 100px auto 5%;
         text-align: center;
         max-width: 1000px;
         padding: 0 18px;
         }
         .grid {
         column-gap: 4vw;
         display: grid;
         grid-template-columns: repeat(4, 1fr);
         margin: 0 5% 5%;
         row-gap: 4vw;
         }
         @media (max-width: 1200px) {
         .grid {
         grid-template-columns: repeat(3, 1fr);
         }
         }
         @media (max-width: 768px) {
         .grid {
         grid-template-columns: repeat(2, 1fr);
         }
         }
         @media (max-width: 480px) {
         .grid {
         grid-template-columns: 1fr;
         }
         }
         .game {
         background: var(--card);
         border: 1px solid #e6e9ef;
         border-radius: 12px;
         padding: 12px;
         text-align: center;
         transition: all 0.2s ease;
         box-shadow: 0 6px 22px rgba(16, 24, 40, 0.06);
         }
         [data-theme="dark"] .game {
         border-color: #334155;
         }
         .game:hover {
         box-shadow: 0 12px 32px rgba(37, 99, 235, 0.15);
         transform: translateY(-4px);
         border-color: #2563eb;
         }
         .game img {
         aspect-ratio: 1/1;
         border-radius: 10px;
         display: block;
         margin-bottom: 10px;
         object-fit: cover;
         width: 100%;
         }
         .game p {
         font-size: 14px;
         font-weight: 600;
         margin: 8px 0 0;
         color: var(--text);
         transition: color 0.3s;
         }

         /* Glow animation for suggestions form */
         @keyframes glow-pulse {
           0%, 100% {
             box-shadow: 0 6px 22px rgba(16, 24, 40, 0.06),
                         0 0 20px rgba(37, 99, 235, 0.4),
                         0 0 40px rgba(37, 99, 235, 0.2);
           }
           50% {
             box-shadow: 0 6px 22px rgba(16, 24, 40, 0.06),
                         0 0 30px rgba(37, 99, 235, 0.6),
                         0 0 60px rgba(37, 99, 235, 0.3);
           }
         }

         .game.priority {
           animation: glow-pulse 2s ease-in-out infinite;
           border-color: #2563eb;
           position: relative;
         }

         .game.priority:hover {
           box-shadow: 0 12px 32px rgba(37, 99, 235, 0.25),
                       0 0 40px rgba(37, 99, 235, 0.4);
           border-color: #1d4ed8;
         }

         iframe {
         border: none;
         height: 100%;
         left: 0;
         position: absolute;
         top: 0;
         width: 100%;
         z-index: 1;
         }
         button {
         cursor: pointer;
         font-family: Inter, system-ui;
         font-weight: 600;
         }
         #back-to-top {
         align-items: center;
         background: var(--card);
         border: 1px solid #e6e9ef;
         border-radius: 8px;
         bottom: 20px;
         color: var(--accent);
         display: flex;
         font-size: 1.2rem;
         height: 48px;
         justify-content: center;
         opacity: 0;
         pointer-events: none;
         position: fixed;
         right: 20px;
         transition: all 0.3s ease;
         width: 48px;
         z-index: 4;
         box-shadow: 0 6px 22px rgba(16, 24, 40, 0.06);
         }
         [data-theme="dark"] #back-to-top {
         border-color: #334155;
         }
         #back-to-top.visible {
         opacity: 1;
         pointer-events: auto;
         }
         #back-to-top:hover {
         background: var(--accent);
         color: #ffffff;
         box-shadow: 0 12px 32px rgba(37, 99, 235, 0.2);
         transform: translateY(-2px);
         }
         #back-to-top:active {
         transform: scale(0.95);
         }
         #back-button {
         align-items: center;
         background: var(--card);
         border: 1px solid #e6e9ef;
         border-radius: 8px;
         box-shadow: 0 6px 22px rgba(16, 24, 40, 0.06);
         color: #2563eb;
         cursor: pointer;
         display: flex;
         font-family: Inter, system-ui;
         font-size: 1.2rem;
         font-weight: 700;
         height: 48px;
         justify-content: center;
         transition: all 0.2s ease;
         width: 48px;
         }
         [data-theme="dark"] #back-button {
         border-color: #334155;
         }
         #back-button:hover {
         background: #2563eb;
         color: #ffffff;
         box-shadow: 0 12px 32px rgba(37, 99, 235, 0.2);
         transform: translateY(-2px);
         }
         #back-button:active {
         box-shadow: inset 0 0 5px rgba(37, 99, 235, 0.3);
         transform: scale(0.95);
         }
         #password-container input {
         background: var(--card);
         border: 1px solid #e6e9ef;
         border-radius: 8px;
         color: var(--text);
         font-size: 0.9rem;
         outline: none;
         padding: 10px 12px;
         font-family: Inter, system-ui;
         transition: background 0.3s, border 0.3s, color 0.3s;
         }
         [data-theme="dark"] #password-container input {
         border-color: #334155;
         }
         #password-container input::placeholder {
         color: var(--muted);
         opacity: 0.7;
         }

         /* Theme Toggle Button */
         .theme-toggle-btn {
         display: inline-flex;
         align-items: center;
         justify-content: center;
         width: 40px;
         height: 40px;
         background: var(--card);
         border: 2px solid var(--accent);
         border-radius: 8px;
         cursor: pointer;
         padding: 0;
         margin-left: 8px;
         color: var(--accent);
         transition: background 0.3s, border 0.3s, color 0.3s;
         }

         .theme-toggle-btn:hover {
         background: var(--accent);
         color: white;
         }

         .theme-icon {
         width: 20px;
         height: 20px;
         display: flex;
         align-items: center;
         justify-content: center;
         }
      </style>
   </head>
   <body>
      <div id="all">
      <div id="top-header">
         <div class="header-left">
            <div class="updates-box" id="updates-box">
                <h2>Site Updates</h2>
                <ul>
                    <li><strong>PRESS '~' to quick exit!</strong></li>
                    <li>Password changes Dec 1</li>
                </ul>
                <div style="margin-top: 14px; padding-top: 12px; border-top: 1px solid #e6e9ef; font-size: 12px; color: var(--text); line-height: 1.6; font-style: italic;">
                    <p style="margin: 0 0 6px 0; font-weight: 600; color: var(--accent);">Password Hint:</p>
                    Still thy bright lamp, let daylight fade,<br>
                    Call forth the hush that dusk has made.<br>
                    For runes lie hid where shadows keep,<br>
                    And only stir when light grows deep.
                </div>
            </div>
         </div>
         <h1>HIMESPIDER</h1>
         <div class="header-right">
            <div id="search-container"><input type="text" id="search-bar" placeholder="Search..."></div>
            <div id="password-container" style="display: flex; gap: 8px; align-items: center;">
                <input type="password" id="password-input" placeholder="Test Password" style="background: var(--card); border: 1px solid #e6e9ef; border-radius: 8px; color: var(--text); font-size: 0.9rem; outline: none; padding: 10px 12px; font-family: Inter, system-ui; flex: 1; max-width: 200px;">
                <div id="password-result" style="font-size: 0.9rem; font-weight: 600; height: 20px; min-width: 0; text-align: center; white-space: nowrap;"></div>
            </div>
            <button id="themeToggle" class="theme-toggle-btn" aria-label="Toggle Dark Mode">
              <div class="theme-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:100%;height:100%"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
              </div>
            </button>
        </div>
      </div>
      <div style="height:80px"></div>
      <div>
        <H2 style="text-align: center; color: #2563eb;">Password Instructions</H2>
        <p style="text-align: center;">The password will change on the first of December. I have left the first hint in the left corner of the screen.<br> You should have no need to leave the website to solve it. You can test the password in the right corner.<br> The first poem does not give you the password, but rather point you towards the second clue.</p>
        <p id="intro">Welcome! This website will fufill your Unbl0cked g@me needs. It is password locked, so no admin can get in, and all games open on the same URL, meaning that there is no way in without the password. <strong>To exit a game, you can move your mouse to the top right corner and a button will appear to exit the game and return to the home website without logging in. Have Fun!</strong><br><br>Yours Truly,<br>HimeSpider</p>
      </div>

      <div class="grid" id="games-grid">
         
      </div>

      <a id="back-to-top" href="#" aria-label="Back to top">
         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up"><path d="m18 15-6-6-6 6"/></svg>
      </a>

    </div>
    
    <script>
        // --- Game Data (Replaces static HTML) ---
        // You should add all your games here in this format.
        const allGames = [
            { name: "Infinite Mario", url: "/pages/mario/main.html", image: "images/mario.jpg" },
            { name: "Geometry Dash", url: "/pages/geodash/index.html", image: "images/goedash.png" },
            { name: "Breakout", url: "/pages/breakout/index.html", image: "images/breakout.png" },
            { name: "Pacman", url: "/pages/pac/index.html", image: "images/pac.png" },
            { name: "Evil Glitch", url: "/pages/EvilGlitch/index.html", image: "images/evilglitch.jpg" },
            { name: "Getting Over It Multiplayer", url: "/pages/goi/index.html", image: "images/gettingoverit.avif" },
            { name: "Terraria", url: "/pages/terraria/index.html", image: "images/terraria.png" },
            { name: "FNAF 1", url: "/pages/fnaf1/index.html", image: "pages/fnaf1/logo.jpg" },
            { name: "FNAF 2", url: "/pages/fnaf2/index.html", image: "pages/fnaf2/logo.jpg" },
            { name: "FNAF 3", url: "/pages/fnaf3/index.html", image: "pages/fnaf3/logo.webp" },
            { name: "FNAF 4", url: "/pages/fnaf4/index.html", image: "pages/fnaf4/logo.webp" },
            { name: "FNAF Ultimate Custom Night", url: "/pages/fnafucn/index.html", image: "pages/fnafucn/logo.webp" },
            { name: "Diablo", url: "/pages/diablo/index.html", image: "images/diablo.webp" },
            { name: "Takeover", url: "/pages/takover/index.html", image: "images/takeover.avif" },
            { name: "1D Game", url: "/pages/1D-Game/index.html", image: "images/lines.jpg" },
            { name: "Retro Bowl", url: "/pages/retro-bowl/index.html", image: "pages/retro-bowl/img/icon.jpg" },
            { name: "Rooftop Snipers", url: "/pages/rooftopsnipers/index.html", image: "pages/rooftopsnipers/img/preview.png" },
            { name: "Tunnel Rush", url: "/pages/tunnel-rush/index.html", image: "pages/tunnel-rush/img/tunnel.jpg" },
            { name: "Doge Miner", url: "/pages/doge-miner/index.html", image: "pages/doge-miner/img/dogeminer_300x300.png" },
            { name: "World's Hardest Game", url: "/pages/worldhardgame/index.html", image: "pages/worldhardgame/images/splash.jpg" },
            { name: "Basketball Stars", url: "/pages/basketballstars/index.html", image: "pages/basketballstars/assets/images/basketball-stars.png" },
            { name: "Backflip", url: "/pages/backflip/index.html", image: "pages/backflip/backflip-dive-3d.jpg" },
            { name: "Cookie Clicker", url: "/pages/cookie-clicker/index.html", image: "images/cookie.webp" },
            { name: "Battle For Gondor", url: "/pages/batforgondor/index.html", image: "pages/batforgondor/battleforgondor.jpg" },
            { name: "Gimme the Airpod", url: "/pages/gimmetheairpod/index.html", image: "pages/gimmetheairpod/img/logo.png" },
            { name: "Factory Balls", url: "/pages/factoryballs/index.html", image: "pages/factoryballs/images/splash.png" },
            { name: "Subway Surfers", url: "/pages/subwaysurfers/index.html", image: "pages/subwaysurfers/splash.jpeg" },
            { name: "Getaway Shootout", url: "/pages/getawayshootout/index.html", image: "pages/getawayshootout/934bde36-a4a1-43d0-8b35-30f15feddbb4.png" },
            { name: "Balloons TD", url: "/pages/balloonstd/index.html", image: "pages/balloonstd/bloonstd.jpg" },
            { name: "Balloons TD 2", url: "/pages/balloonstd2/index.html", image: "pages/balloonstd2/bloonstd2.png" },
            { name: "Minecraft", url: "/pages/Eaglercraft/Eaglercraft.html", image: "pages/Eaglercraft/minecraft.jpg" },
            { name: "Celeste", url: "/pages/Celeste/celeste.html", image: "pages/Celeste/celeste.jpg" },
            { name: "Slope", url: "/pages/Slope/index.html", image: "pages/Slope/slope4.jpeg" },
            { name: "Portal", url: "/pages/portal/game.html", image: "pages/portal/portal.avif" },
            { name: "Pokemon Unbound", url: "/pages/PokemonUnbound/index.html", image: "pages/PokemonUnbound/unbound.jpg" },
            { name: "Vex 4", url: "/pages/vex4/index.html", image: "pages/vex4/vex4.png" },
            { name: "Vex 5", url: "/pages/vex5/index.html", image: "pages/vex5/vex.jpeg" },
            { name: "Vex 6", url: "/pages/vex6/index.html", image: "pages/vex6/assets/icon.jpeg" },
            { name: "Fnaf 6: Pizza Simulator", url: "/pages/fnafps/index.html", image: "pages/fnafps/fnafps.png" },
            { name: "Sonic the Hedgehog 3", url: "/pages/sonic3/index.html", image: "pages/sonic3/sonic3.jpg" },
            { name: "Mortal Kombat 3", url: "/pages/MortalKombat3/index.html", image: "pages/MortalKombat3/mk3.jpeg" },
            { name: "Fnaf World", url: "/pages/fnafw/index.html", image: "pages/fnafw/fnafworld.webp" },
            { name: "Super Meatboy", url: "/pages/Meatboy/game.html", image: "pages/Meatboy/meatboy.jpg" },
            { name: "2048", url: "/pages/2048/index.html", image: "pages/2048/2048.png" },
            { name: "The Impossible Quiz", url: "/pages/impossiblequiz/game.html", image: "pages/impossiblequiz/impossiblequiz.jpg" },
            { name: "Hollow Knight", url: "/pages/hollow-knight-main/index.html", image: "pages/hollow-knight-main/hollowknight.png" },
            { name: "Super Smash Bros", url: "/pages/SSB/game.html", image: "pages/SSB/ssb.webp" },
            { name: "Balatro", url: "/pages/belatro/index.html", image: "pages/belatro/belatro.jpg" },
            { name: "Undertale", url: "pages/undertale/undertale.html", image: "pages/undertale/undertale.jpg" },
            { name: "Deltarune", url: "pages/deltarune/index.html", image: "pages/deltarune/deltarune.jpg" },
            { name: "Moto X3M", url: "pages/motox3m/index.html", image: "pages/motox3m/moto-x3m.png" },
            { name: "Sonic & Knuckles", url: "pages/Sonic&Knuckles/index.html", image: "pages/Sonic&Knuckles/s&n.webp" },
            { name: "Tanuki Sunset", url: "pages/tsunset/index.html", image: "pages/tsunset/img/cover.png" },
            { name: "10 Minutes Till Dawn", url: "/pages/10-minutes-till-dawn/index.html", image: "pages/10-minutes-till-dawn/tmtd.png" },
            { name: "1v1 LOL", url: "/pages/1v1-lol/index.html", image: "pages/1v1-lol/1v1.png" },
            { name: "Abandoned", url: "/pages/abandoned/index.html", image: "pages/abandoned/abd.png" },
            { name: "A Dark Room", url: "/poem.html", image: "images/adr.png" },
            { name: "Ages of Conflict", url: "/pages/ages-of-conflict/index.html", image: "pages/ages-of-conflict/aoc.jpg" },
            { name: "Amidst the Sky", url: "/pages/amidst-the-sky/index.html", image: "pages/amidst-the-sky/ats.png" },
            { name: "Another Gentleman's Adventure", url: "/pages/another-gentlemans-adventure/index.html", image: "pages/another-gentlemans-adventure/aga.jpg" },
            { name: "Awesome Tanks 2", url: "/pages/awesome-tanks-2/index.html", image: "pages/awesome-tanks-2/at2.png" },
            { name: "Awesome Tanks", url: "/pages/awesome-tanks/index.html", image: "pages/awesome-tanks/at.png" },
            { name: "Babel Tower", url: "/pages/babel-tower/index.html", image: "pages/babel-tower/bt.avif" },
            { name: "Basket Random", url: "/pages/basket-random/index.html", image: "pages/basket-random/br.png" },
            { name: "BitLife", url: "/pages/bit-life/index.html", image: "pages/bit-life/bl.png" },
            { name: "Boxing Random", url: "/pages/boxing-random/index.html", image: "pages/boxing-random/br.png" },
            { name: "Chrome Dino", url: "/pages/chrome-dino/index.html", image: "pages/chrome-dino/cd.webp" },
            { name: "Clicker Heroes", url: "/pages/clicker-heroes-updated/index.html", image: "pages/clicker-heroes-updated/ch.jpeg" },
            { name: "Conway's Game of Life", url: "/pages/conways-game-of-life/index.html", image: "pages/conways-game-of-life/cgl.png" },
            { name: "Core Ball", url: "/pages/core-ball/index.html", image: "pages/core-ball/cb.jpg" },
            { name: "Crossy Road", url: "/pages/crossy-road/index.html", image: "pages/crossy-road/cr.jpeg" },
            { name: "Cut the Rope", url: "/pages/cut-the-rope/index.html", image: "pages/cut-the-rope/ctr.png" },
            { name: "Dadish", url: "/pages/dadish/index.html", image: "pages/dadish/dd.jpg" },
            { name: "Dadish 2", url: "/pages/dadish-2/index.html", image: "pages/dadish-2/dd2.png" },
            { name: "Dadish 3", url: "/pages/dadish-3/index.html", image: "pages/dadish-3/dd3.webp" },
            { name: "Doodle Jump", url: "/pages/doodle-jump/index.html", image: "pages/doodle-jump/icon.png" },
            { name: "Drift Boss", url: "/pages/drift-boss/index.html", image: "pages/drift-boss/db.png" },
            { name: "Drive Mad", url: "/pages/drive-mad/index.html", image: "pages/drive-mad/dm.jpg" },
            { name: "Duck Life 4", url: "/pages/duck-life-4/index.html", image: "pages/duck-life-4/dl4.jpg" },
            { name: "Dune", url: "/pages/dune/index.html", image: "pages/dune/dune.png" },
            { name: "Evowars", url: "/pages/evowars/index.html", image: "pages/evowars/evo.jpeg" },
            { name: "Fireboy and Watergirl", url: "/pages/fireboy-and-watergirl/index.html", image: "pages/fireboy-and-watergirl/fb1.jpeg" },
            { name: "Fireboy and Watergirl 2", url: "/pages/fireboy-and-watergirl-2/index.html", image: "pages/fireboy-and-watergirl-2/fb2.jpeg" },
            { name: "Fireboy and Watergirl 3", url: "/pages/fireboy-and-watergirl-3/index.html", image: "pages/fireboy-and-watergirl-3/fb3.jpeg" },
            { name: "Fireboy and Watergirl 4", url: "/pages/fireboy-and-watergirl-4/index.html", image: "pages/fireboy-and-watergirl-4/fb4.jpeg" },
            { name: "Flappy Bird", url: "/pages/flappy-bird/index.html", image: "pages/flappy-bird/fb.webp" },
            { name: "FNAF Sister Location", url: "/pages/fnafsl/index.html", image: "pages/fnafsl/fnafsl.webp" },
            { name: "Friday Night Funkin'", url: "/pages/friday-night-funkin/index.html", image: "pages/friday-night-funkin/fnf.avif" },
            { name: "Gons.io", url: "/pages/gons-io/index.html", image: "pages/gons-io/gons.jpg" },
            { name: "Gun Spin", url: "/pages/gunspin/index.html", image: "pages/gunspin/gs.png" },
            { name: "Hextris", url: "/pages/hextris/index.html", image: "pages/hextris/hex.png" },
            { name: "Idle Breakout", url: "/pages/idle-breakout/index.html", image: "pages/idle-breakout/ib.avif" },
            { name: "Incremancer", url: "/pages/incremancer/index.html", image: "pages/incremancer/ic.webp" },
            { name: "Maptroid", url: "/pages/maptroid/index.html", image: "pages/maptroid/mt.png" },
            { name: "Mario Game", url: "/pages/mario-game/index.html", image: "pages/mario-game/sm.png" },
            { name: "Monkey Mart", url: "/pages/monkey-mart/index.html", image: "pages/monkey-mart/mm.webp" },
            { name: "N-Gon", url: "/pages/n-gon/index.html", image: "pages/n-gon/ngon.png" },
            { name: "N-Step Steve Part 1", url: "/pages/n-step-steve-part-1/index.html", image: "pages/n-step-steve-part-1/nss1.png" },
            { name: "N-Step Steve Part 2", url: "/pages/n-step-steve-part-2/index.html", image: "pages/n-step-steve-part-2/nss2.png" },
            { name: "OvO", url: "/pages/ovo/2.0.2alpha/index.html", image: "pages/ovo/ovo.jpg" },
            { name: "Particle Clicker", url: "/pages/particle-clicker/index.html", image: "pages/particle-clicker/pc.png" },
            { name: "P-Craft", url: "/pages/pcraft/index.html", image: "pages/pcraft/pc.png" },
            { name: "Planet Life", url: "/pages/planet-life/index.html", image: "pages/planet-life/pl.png" },
            { name: "Precision Client", url: "/pages/precision-client/index.html", image: "pages/precision-client/pc.webp" },
            { name: "Progress Knight", url: "/pages/progress-knight/index.html", image: "pages/progress-knight/pk.png" },
            { name: "Pull of War", url: "/pages/pull-of-war/index.html", image: "pages/pull-of-war/pics/line3.png" },
            { name: "Reach the Core", url: "/pages/reach-the-core/index.html", image: "pages/reach-the-core/rtc.jpg" },
            { name: "Restless Wing Syndrome", url: "/pages/restless-wing-syndrome/index.html", image: "pages/restless-wing-syndrome/rws.png" },
            { name: "Rift Shift", url: "/pages/rift-shift/index.html", image: "pages/rift-shift/rs.png" },
            { name: "Rookie Bowman", url: "/pages/rookie-bowman/index.html", image: "pages/rookie-bowman/rb.jpg" },
            { name: "Run 3", url: "/pages/run-3/index.html", image: "pages/run-3/r3.avif" },
            { name: "Sandspiel", url: "/pages/sandspiel/index.html", image: "pages/sandspiel/ss.jpg" },
            { name: "Scuba Bear", url: "/pages/scuba-bear/index.html", image: "pages/scuba-bear/sb.jpg" },
            { name: "Smart Ball", url: "/pages/smart-ball/index.html", image: "pages/smart-ball/sb.jpg" },
            { name: "Smash Karts", url: "/pages/smash-karts/index.html", image: "pages/smash-karts/sk.png" },
            { name: "Stickman Hook", url: "/pages/stickman-hook/index.html", image: "pages/stickman-hook/smh.png" },
            { name: "Subway Surfers NY", url: "/pages/subway-surfers-ny/index.html", image: "pages/subway-surfers-ny/ssny.webp" },
            { name: "Temple Run 2", url: "/pages/temple-run-2/index.html", image: "pages/temple-run-2/tr2.avif" },
            { name: "The Final Earth", url: "/pages/the-final-earth/index.html", image: "pages/the-final-earth/tfe.png" },
            { name: "There is No Game", url: "/pages/there-is-no-game/index.html", image: "pages/there-is-no-game/ting.webp" },
            { name: "Time Shooter", url: "/pages/time-shooter/index.html", image: "pages/time-shooter/ts.png" },
            { name: "Time Shooter 3", url: "/pages/time-shooter-3/index.html", image: "pages/time-shooter-3/ts3.png" },
            { name: "Tiny Fishing", url: "/pages/tiny-fishing/index.html", image: "pages/tiny-fishing/tf.jpeg" },
            { name: "Trace", url: "/pages/trace/index.html", image: "pages/trace/trace.png" },
            { name: "Two Ball 3D", url: "/pages/two-ball-3d/index.html", image: "pages/two-ball-3d/tb3d.webp" },
            { name: "Web Osu", url: "/pages/web-osu/index.html", image: "pages/web-osu/webosu.jpeg" },
            { name: "X Trench Run", url: "/pages/x-trench-run/index.html", image: "pages/x-trench-run/xtr.jpeg" },
            { name: "Yohoho", url: "/pages/yohoho/index.html", image: "pages/yohoho/img/banner1024x512.jpg" },
            { name: "Henry Stickman: Breaking the Bank", url: "/pages/hscBreakBank/index.html", image: "pages/hscBreakBank/bb.webp" },
            { name: "Henry Stickman: Escape the Prison", url: "/pages/hscEscapePrison/index.html", image: "pages/hscEscapePrison/ep.jpg" },
            { name: "Henry Stickman: Fleeing the Complex", url: "/pages/hscFleeComplex/index.html", image: "pages/hscFleeComplex/fc.jpg" },
            { name: "Henry Stickman: Infiltrate the Airship", url: "/pages/hscInfiltrateAirship/index.html", image: "pages/hscInfiltrateAirship/ia.jpg" },
            { name: "Henry Stickman: Steal the Diamond", url: "/pages/hscStealDiamond/index.html", image: "pages/hscStealDiamond/sd.jpeg" },
            { name: "Polytrack", url: "/pages/polytrack/index.html", image: "pages/polytrack/poly.png" },
            { name: "Grey-Box Testing", url: "/pages/gbt/index.html", image: "pages/gbt/gbt.png" },
            { name: "1", url: "/pages/1/index.html", image: "pages/1/meta/apple-touch-icon.png" },
            { name: "1v1 Space", url: "/pages/1v1space/index.html", image: "pages/1v1space/splash.png" },
            { name: "9007199254740992", url: "/pages/9007199254740992/index.html", image: "pages/9007199254740992/logo-4.png" },
            { name: "Achievement Unlocked", url: "/pages/achievementunlocked/index.html", image: "pages/achievementunlocked/achievementunlocked.png" },
            { name: "Adrenaline Challenge", url: "/pages/adrenalinechallenge/index.html", image: "pages/adrenalinechallenge/adrenalinechallenge.jpg" },
            { name: "Among Us", url: "/pages/among-us/index.html", image: "pages/among-us/red.png" },
            { name: "Avalanche", url: "/pages/avalanche/index.html", image: "pages/avalanche/avalanche.png" },
            { name: "The Backrooms", url: "/pages/backrooms/index.html", image: "pages/backrooms/img/splash.jpg" },
            { name: "Big Red Button", url: "/pages/bigredbutton/index.html", image: "pages/bigredbutton/bigredbutton.png" },
            { name: "Black Knight", url: "/pages/blackknight/index.html", image: "pages/blackknight/blackknight.png" },
            { name: "Bloxors", url: "/pages/bloxors/index.html", image: "pages/bloxors/block.png" },
            { name: "Boxhead 2Play", url: "/pages/boxhead2play/index.html", image: "pages/boxhead2play/boxhead2play.jpg" },
            { name: "Big Tower Tiny Square", url: "/pages/btts/index.html", image: "pages/btts/images.png" },
            { name: "Cannon Basketball 4", url: "/pages/cannon-basketball-4/index.html", image: "pages/cannon-basketball-4/assets/images/cb4.webp" },
            { name: "Canyon Defense", url: "/pages/canyondefense/index.html", image: "pages/canyondefense/canyondefense.png" },
            { name: "Cell Machine", url: "/pages/cell-machine/index.html", image: "pages/cell-machine/img/icon.png" },
            { name: "Champion Archer", url: "/pages/championarcher/index.html", image: "pages/championarcher/championarcher.png" },
            { name: "Circlo", url: "/pages/circlo/index.html", image: "pages/circlo/img/download.png" },
            { name: "Connect 3", url: "/pages/connect3/index.html", image: "pages/connect3/connect3.png" },
            { name: "Craftmine", url: "/pages/craftmine/index.html", image: "pages/craftmine/images/craftmine.png" },
            { name: "Creative Kill Chamber", url: "/pages/creativekillchamber/index.html", image: "pages/creativekillchamber/creativekillchamber.jpg" },
            { name: "CSGo Clicker", url: "/pages/csgo-clicker/index.html", image: "pages/csgo-clicker/csgc.png" },
            { name: "Cut the Rope - Holiday Gift", url: "/pages/ctr-holiday/index.html", image: "pages/ctr-holiday/Holiday_Gift.webp" },
            { name: "Cut the Rope - Time Travel", url: "/pages/ctr-tr/index.html", image: "pages/ctr-tr/logo.png" },
            { name: "Cubefield", url: "/pages/cubefield/index.html", image: "pages/cubefield/cubefield.jpg" },
            { name: "Cupcake 2048", url: "/pages/cupcake2048/index.html", image: "pages/cupcake2048/meta/apple-touch-icon.png" },
            { name: "Deal or No Deal", url: "/pages/deal-or-no-deal/index.html", image: "pages/deal-or-no-deal/index.jpg" },
            { name: "Death Run 3d", url: "/pages/death-run-3d/index.html", image: "pages/death-run-3d/img/death.png" },
            { name: "Defend the Tank", url: "/pages/defend-the-tank/index.html", image: "pages/defend-the-tank/images/logo.jpg" },
            { name: "Doge 2048", url: "/pages/doge2048/index.html", image: "pages/doge2048/doge1.jpeg" },
            { name: "Double Wires", url: "/pages/doublewires/index.html", image: "pages/doublewires/doublewires.png" },
            { name: "Draw the Hill", url: "/pages/draw-the-hill/index.html", image: "pages/draw-the-hill/icons/icon-512.png" },
            { name: "Duck Life", url: "/pages/ducklife1/index.html", image: "pages/ducklife1/ducklife.png" },
            { name: "Duck Life 2", url: "/pages/ducklife2/index.html", image: "pages/ducklife2/ducklife2.png" },
            { name: "Duck Life 3", url: "/pages/ducklife3/index.html", image: "pages/ducklife3/duck.png" },
            { name: "Edge Not Found", url: "/pages/edgenotfound/index.html", image: "pages/edgenotfound/edge.png" },
            { name: "Elastic Man", url: "/pages/elasticman/index.html", image: "pages/elasticman/elasticman.jpg" },
            { name: "Endless War 3", url: "/pages/endlesswar3/index.html", image: "pages/endlesswar3/endlesswar3.png" },
            { name: "Exo", url: "/pages/exo/index.html", image: "pages/exo/img/small.jpg" },
            { name: "Fake Virus", url: "/pages/fake-virus/index.html", image: "pages/fake-virus/fake-virus.png" },
            { name: "Flappy 2048", url: "/pages/flappy-2048/index.html", image: "pages/flappy-2048/meta/apple-touch-icon.png" },
            { name: "Flash Tetris", url: "/pages/flashtetris/index.html", image: "pages/flashtetris/flashtetris.png" },
            { name: "Game Inside a Game", url: "/pages/game-inside/index.html", image: "pages/game-inside/giag.png" },
            { name: "Glass City", url: "/pages/glass-city/index.html", image: "pages/glass-city/image.png" },
            { name: "Google Snake", url: "/pages/google-snake/index.html", image: "pages/google-snake/img/snake.png" },
            { name: "Grindcraft", url: "/pages/grindcraft/index.html", image: "pages/grindcraft/img/splash.png" },
            { name: "Hacker Type", url: "/pages/hackertype/index.html", image: "pages/hackertype/logo192.png" },
            { name: "Hover Bot Arena", url: "/pages/hba/index.html", image: "pages/hba/hoverbotarena.jpg" },
            { name: "Helicopter", url: "/pages/helicopter/index.html", image: "pages/helicopter/helicopter.png" },
            { name: "Hex Empire", url: "/pages/hexempire/index.html", image: "pages/hexempire/hexempire.jpg" },
            { name: "HexGL", url: "/pages/HexGL/index.html", image: "pages/HexGL/icon_256.png" },
            { name: "Idle Shart", url: "/pages/idle-shark/index.html", image: "pages/idle-shark/img/sharklogo.png" },
            { name: "Interactive Buddy", url: "/pages/interactivebuddy/index.html", image: "pages/interactivebuddy/interactivebuddy.jpg" },
            { name: "Just One Boss", url: "/pages/just-one-boss/index.html", image: "pages/just-one-boss/pv1Gr5.png" },
            { name: "Kitten Cannon", url: "/pages/kittencannon/index.html", image: "pages/kittencannon/kittencannon.png" },
            { name: "Krunker.io", url: "/pages/krunker/index.html", image: "pages/krunker/img/krunker-io.jpg" },
            { name: "Learn to Fly", url: "/pages/learntofly/index.html", image: "pages/learntofly/learntofly.png" },
            { name: "Matrix Rampage", url: "/pages/matrixrampage/index.html", image: "pages/matrixrampage/matrixrampage.jpg" },
            { name: "Meme 2048", url: "/pages/meme2048/index.html", image: "pages/meme2048/meta/apple-touch-startup-image-640x1096.png" },
            { name: "Minecraft Classic", url: "/pages/minecraft-classic/index.html", image: "pages/minecraft-classic/pack.png" },
            { name: "Minesweeper", url: "/pages/minesweeper/index.html", image: "pages/minesweeper/img/minesweeper.png" },
            { name: "Mini Putt", url: "/pages/miniputt/index.html", image: "pages/miniputt/miniputt.png" },
            { name: "Missiles", url: "/pages/missiles/index.html", image: "pages/missiles/miss.png" },
            { name: "MotoX3M Pool", url: "/pages/motox3m-pool/index.html", image: "pages/motox3m-pool/splash.jpg" },
            { name: "MotoX3M Spooky", url: "/pages/motox3m-spooky/index.html", image: "pages/motox3m-spooky/splash.jpeg" },
            { name: "MotoX3M Winter", url: "/pages/motox3m-winter/index.html", image: "pages/motox3m-winter/download.jpeg" },
            { name: "NS Shaft", url: "/pages/ns-shaft/index.html", image: "pages/ns-shaft/nss.webp" },
            { name: "Om Bounce", url: "/pages/om-bounce/index.html", image: "pages/om-bounce/assets/icon.png" },
            { name: "Pandemic 2", url: "/pages/pandemic2/index.html", image: "pages/pandemic2/pandemic2.png" },
            { name: "Papa's Pizzaria", url: "/pages/papaspizzaria/index.html", image: "pages/papaspizzaria/papaspizzaria.jpg" },
            { name: "Paper.io 2", url: "/pages/paperio2/index.html", image: "pages/paperio2/images/icon512.png" },
            { name: "Papery Planes", url: "/pages/papery-planes/index.html", image: "pages/papery-planes/splash.jpg" },
            { name: "PolyBranch", url: "/pages/polybranch/index.html", image: "pages/polybranch/img/pic1.png" },
            { name: "Push the Square", url: "/pages/push-the-square/index.html", image: "pages/push-the-square/img/splash.png" },
            { name: "Push Your Luck", url: "/pages/push-your-luck/index.html", image: "pages/push-your-luck/pyl.jpeg" },
            { name: "Rolly Vortex", url: "/pages/rolly-vortex/index.html", image: "pages/rolly-vortex/icon-256.png" },
            { name: "Sand Game", url: "/pages/sand-game/index.html", image: "pages/sand-game/sand-game.PNG" },
            { name: "Super Mario 64", url: "/pages/sm64/index.html", image: "pages/sm64/logo.png" },
            { name: "Smoking Barrels", url: "/pages/smokingbarrels/index.html", image: "pages/smokingbarrels/smokingbarrels.jpg" },
            { name: "Snow Battle", url: "/pages/snowbattle/index.html", image: "pages/snowbattle/img/logo.png" },
            { name: "Soldier Legend", url: "/pages/soldier-legend/index.html", image: "pages/soldier-legend/images/splash.jpeg" },
            { name: "Sort the Court", url: "/pages/sort-the-court/index.html", image: "pages/sort-the-court/img/splash.png" },
            { name: "Soundboard", url: "/pages/soundboard/index.html", image: "pages/soundboard/img/mlg.png" },
            { name: "Stack", url: "/pages/stack/index.html", image: "pages/stack/stack.png" },
            { name: "Stack Bump 3d", url: "/pages/stack-bump-3d/index.html", image: "pages/stack-bump-3d/thumbnail.jpg" },
            { name: "Stick War", url: "/pages/stickwar/index.html", image: "pages/stickwar/stickwar.jpg" },
            { name: "Storm the House 2", url: "/pages/stormthehouse2/index.html", image: "pages/stormthehouse2/stormthehouse2.jpg" },
            { name: "Superhot", url: "/pages/superhot/index.html", image: "pages/superhot/hot.jpg" },
            { name: "Swerve", url: "/pages/swerve/index.html", image: "pages/swerve/img/favicon.jpg" },
            { name: "Tactial Assasin", url: "/pages/tacticalassasin2/index.html", image: "pages/tacticalassasin2/tacticalassassin2.png" },
            { name: "Tank Trouble 2", url: "/pages/tank-trouble-2/index.html", image: "pages/tank-trouble-2/icon-256.png" },
            { name: "The Battle", url: "/pages/thebattle/index.html", image: "pages/thebattle/thebattle.png" },
            { name: "The Heist", url: "/pages/theheist/index.html", image: "pages/theheist/theheist.jpg" },
            { name: "This is the Only Level", url: "/pages/thisistheonlylevel/index.html", image: "pages/thisistheonlylevel/thisistheonlylevel.png" },
            { name: "Toss the Turtle", url: "/pages/tosstheturtle/index.html", image: "pages/tosstheturtle/tosstheturtle.png" },
            { name: "Tube Jumpers", url: "/pages/tube-jumpers/index.html", image: "pages/tube-jumpers/img/icon.jpg" },
            { name: "Tv Static", url: "/pages/tv-static/index.html", image: "pages/tv-static/static.png" },
            { name: "Webretro", url: "/pages/webretro-local/index.html", image: "pages/webretro-local/assets/icon204.png" },
            { name: "Wolfenstein 3d", url: "/pages/wolf3d/index.html", image: "pages/wolf3d/art/wolf3d.png" },
            { name: "Wordle", url: "/pages/wordle/index.html", image: "pages/wordle/img/logo_192x192.png" },
            { name: "Worlds Hardest Game 2", url: "/pages/worlds-hardest-game-2/index.html", image: "pages/worlds-hardest-game-2/the-worlds-hardest-game-2.jpg" }
        ];

        // --- Core Rendering Logic ---
        function renderGames(gamesToRender) {
            const grid = document.getElementById('games-grid');
            if (!grid) return;

            // Clear existing games
            grid.innerHTML = '';

            gamesToRender.forEach(game => {
                const gameDiv = document.createElement('div');
                gameDiv.className = 'game';

                if (game.isPriority) {
                    gameDiv.classList.add('priority');
                }

                // Determines if the click handler uses 'window.open' for external link
                // or the local 'beep' function
                const clickHandler = game.isExternal
                    ? `window.open('${game.url}', '_blank')`
                    : `beep('${game.url}')`;

                gameDiv.setAttribute('onclick', clickHandler);
                gameDiv.innerHTML = `
                    <img loading="lazy" src="${game.image}">
                    <p>${game.name}</p>
                `;
                grid.appendChild(gameDiv);
            });
        }

        // --- Core Filtering and Sorting Logic ---
        function sortAndFilterGames() {
            const searchBar = document.getElementById('search-bar');
            const searchTerm = searchBar ? searchBar.value.toLowerCase() : '';

            // 1. Filter games based on search term (only filter if a search term exists)
            let filteredGames = allGames.filter(game => {
                const nameMatch = game.name.toLowerCase().includes(searchTerm);
                // Always show the priority/external form regardless of search
                return nameMatch || game.isPriority;
            });

            // 2. Sort the filtered games
            filteredGames.sort((a, b) => {
                // Keep priority game at the very top
                if (a.isPriority) return -1; 
                if (b.isPriority) return 1;
                
                // Sort the rest alphabetically by name
                return a.name.localeCompare(b.name);
            });

            renderGames(filteredGames);
        }

        function setupSearch() {
            const searchBar = document.getElementById('search-bar');
            if (searchBar) {
                searchBar.addEventListener('input', sortAndFilterGames);
            }
        }
        
        // --- Password Verification Logic ---
        function verifyPassword() {
            const input = document.getElementById('password-input');
            const result = document.getElementById('password-result');
            const encoded = atob('VjFrMW5nMg=='); // Base64 encoded
            
            if (input.value === '') {
                result.textContent = '';
                result.style.color = '';
            } else if (input.value === encoded) {
                result.textContent = '✓ Correct';
                result.style.color = '#10b981';
            } else {
                result.textContent = '✗ Incorrect';
                result.style.color = '#ef4444';
            }
        }

        // --- Theme Management (unchanged) ---
        // Apply theme immediately from localStorage
        const theme = localStorage.getItem('studybuddy-theme') || 'light';
        document.documentElement.setAttribute('data-theme', theme);
        
        // Theme Management Class
        class ThemeManager {
            constructor() {
                this.theme = localStorage.getItem('studybuddy-theme') || 'light';
                this.init();
            }
            init() {
                this.applyTheme(this.theme);
                this.setupButton();
                this.listenForExternalChanges();
            }
            applyTheme(theme) {
                this.theme = theme || 'light';
                document.documentElement.setAttribute('data-theme', this.theme);
                localStorage.setItem('studybuddy-theme', this.theme);
                this.updateButton();
                this.broadcastToParent();
            }
            toggle() {
                const newTheme = this.theme === 'light' ? 'dark' : 'light';
                this.applyTheme(newTheme);
            }
            setupButton() {
                const btn = document.getElementById('themeToggle');
                if (btn) {
                    btn.addEventListener('click', () => this.toggle());
                }
            }
            updateButton() {
                const btn = document.getElementById('themeToggle');
                if (btn) {
                    const icon = btn.querySelector('.theme-icon');
                    if (icon) {
                        icon.innerHTML = this.theme === 'light' 
                            ? '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:100%;height:100%"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'
                            : '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:100%;height:100%"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="4.22" x2="19.78" y2="5.64"></line></svg>';
                    }
                }
            }
            broadcastToParent() {
                 if (window.parent !== window.self) {
                     window.parent.postMessage({ theme: this.theme }, '*');
                 }
            }
            listenForExternalChanges() {
                window.addEventListener('message', (event) => {
                    if (event.data.theme && event.data.theme !== this.theme) {
                        this.applyTheme(event.data.theme);
                    }
                });
            }
        }

        // --- Game Iframe/Exit Button Logic (unchanged) ---
        function beep(t) {
            window.appState.isInGame = true;
            const n = document.createElement("iframe");
            n.setAttribute("src", t);
            n.style.position = "fixed";
            n.style.top = "0";
            n.style.left = "0";
            n.style.width = "100%";
            n.style.height = "100%";
            n.style.zIndex = "1000";
            document.getElementById("all").hidden = true;
            const o = document.body.style.overflow;
            document.body.style.overflow = "hidden";
            const l = document.createElement("a");
            l.id = "back-button";
            l.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>';
            l.style.opacity = "0";
            l.style.pointerEvents = "none";
            l.style.position = "fixed";
            l.style.top = "20px";
            l.style.right = "20px";
            l.style.zIndex = "1002";
            let d = null, i = !1;
            const s = document.createElement("div");
            s.style.position = "fixed";
            s.style.top = "0";
            s.style.right = "0";
            s.style.width = "100px";
            s.style.height = "100px";
            s.style.zIndex = "1001";
            s.style.background = "transparent";
            s.style.pointerEvents = "auto";
            
            function r() {
                d && (clearTimeout(d), d = null);
                l.style.opacity = "1";
                l.style.pointerEvents = "auto";
            }
            function a() {
                i || (d && clearTimeout(d), d = setTimeout(() => {
                    i || (l.style.opacity = "0", l.style.pointerEvents = "none");
                }, 400));
            }

            s.addEventListener("mouseenter", r);
            s.addEventListener("mouseleave", () => {
                d && clearTimeout(d);
                d = setTimeout(() => {
                    i || (l.style.opacity = "0", l.style.pointerEvents = "none");
                }, 100);
            });
            l.addEventListener("mouseenter", () => {
                i = !0;
                r();
            });
            l.addEventListener("mouseleave", () => {
                i = !1;
                a();
            });
            
            l.onclick = function() {
                window.appState.isInGame = false;
                document.body.removeChild(n);
                document.body.removeChild(l);
                document.body.removeChild(s);
                document.getElementById("all").hidden = false;
                document.body.style.overflow = o;
            };

            document.body.appendChild(n);
            document.body.appendChild(s);
            document.body.appendChild(l);
            // FIX: Focus the iframe so keyboard events are captured properly
            n.addEventListener('load', function() {
                try {
                    n.focus();
                    n.contentWindow.focus();
                } catch (e) {
                    console.error("Could not focus iframe contentWindow:", e);
                }
            });
        }
        
        // --- Document Ready and Event Listeners ---
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize Theme Manager
            new ThemeManager();
            
            // App State for Quick Exit Logic
            window.appState = { isInGame: false };
            
            // Quick Exit (~) Logic
            document.addEventListener('keydown', (e) => {
                if (e.key === '~' && window.appState.isInGame) {
                    const backButton = document.getElementById('back-button');
                    if (backButton) {
                        backButton.click();
                    }
                }
            });

            // Password Input Listener
            const passwordInput = document.getElementById('password-input');
            if (passwordInput) {
                passwordInput.addEventListener('input', verifyPassword);
            }
            
            // Header Scroll and Back-to-Top Logic
            const topHeader = document.getElementById("top-header");
            const backToTop = document.getElementById("back-to-top");

            // Update header appearance on scroll
            window.addEventListener("scroll", () => {
                if (topHeader) {
                    if (window.scrollY > 0) topHeader.classList.add("scrolled");
                    else topHeader.classList.remove("scrolled");
                }

                if (backToTop) {
                    if (window.scrollY > 300) backToTop.classList.add("visible");
                    else backToTop.classList.remove("visible");
                }
            });

            if (backToTop) {
                backToTop.addEventListener("click", (e) => {
                    e.preventDefault();
                    window.scrollTo({ top: 0, behavior: "smooth" });
                });
            }

            // Initial setup - **This now calls the new JS functions to render games**
            sortAndFilterGames();
            setupSearch();
        });
    </script>
   </body>
</html>