<!doctype html>
<html lang="en">
<head>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/x-icon" src="favicon.ico">
<title>StudyBuddy - Personal Study Tool</title>
<style>
  :root{
    --bg:#f6f8fb; 
    --card:#ffffff; 
    --muted:#6b7280; 
    --accent:#2563eb;
    --success:#10b981; 
    --danger:#ef4444; 
    --radius:12px;
    --text:#0f172a;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  [data-theme="dark"] {
    --bg:#0f172a;
    --card:#1e293b;
    --muted:#94a3b8;
    --text:#f1f5f9;
  }

  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg), var(--bg));color:var(--text);min-height:100vh;transition:background 0.3s, color 0.3s}
  .wrap{max-width:1000px;margin:28px auto;padding:18px;} 
  header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
  .logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px}
  h1{font-size:20px;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 22px rgba(16,24,40,0.06);padding:18px;margin-bottom:14px;transition:background 0.3s}
  .center{display:flex;align-items:center;justify-content:center}
  input[type="password"], input[type="text"]{padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;min-width:220px;background:var(--card);color:var(--text);transition:background 0.3s, color 0.3s, border 0.3s}
  [data-theme="dark"] input[type="password"], [data-theme="dark"] input[type="text"]{border-color:#334155}
  button{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-size:14px;transition:opacity 0.2s}
  button:disabled{opacity:0.5;cursor:not-allowed}
  button.ghost{background:transparent;color:var(--accent);border:1px solid #dbe5ff;transition:background 0.2s, border 0.2s}
  [data-theme="dark"] button.ghost{border-color:#334155}
  button.secondary{background:#6366f1;color:white}
  button.danger{background:#ef4444;color:white}
  small.note{color:var(--muted);display:block;margin-top:8px;font-size:12px}
  .nav{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
  .nav button{background:transparent;color:var(--muted);padding:8px 12px;border-radius:8px;border:1px solid transparent;font-size:14px;transition:background 0.2s}
  .nav button.active{background:#eef2ff;color:var(--accent);border-color:#dbeafe}
  [data-theme="dark"] .nav button.active{background:rgba(37,99,235,0.2);border-color:rgba(37,99,235,0.4)}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:14px}
  @media(max-width:900px){ .grid{grid-template-columns:1fr} .rightcol{order:2} }

  .form-group{margin-bottom:14px}
  .form-group label{display:block;font-weight:600;margin-bottom:6px;font-size:14px;color:var(--text)}
  .form-group input, .form-group textarea, .form-group select{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;font-family:inherit;background:var(--card);color:var(--text);transition:background 0.3s, color 0.3s, border 0.3s}
  [data-theme="dark"] .form-group input, [data-theme="dark"] .form-group textarea, [data-theme="dark"] .form-group select{border-color:#334155}
  .form-group textarea{min-height:100px;resize:vertical}
  .card-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .card-item{padding:10px;border-radius:8px;background:#f9fafb;border:1px solid #e6e9ef;display:flex;justify-content:space-between;align-items:center;transition:background 0.3s, border 0.3s}
  [data-theme="dark"] .card-item{background:#334155;border-color:#475569}
  .card-item-text{flex:1;color:var(--text)}
  .card-item button{padding:6px 10px;font-size:12px}
  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center;transition:color 0.3s}
  a.small{font-size:13px;color:var(--accent);text-decoration:none}
  .tabs-secondary{display:flex;gap:6px;margin-bottom:12px;border-bottom:2px solid #f1f5f9;padding-bottom:8px;transition:border 0.3s}
  [data-theme="dark"] .tabs-secondary{border-bottom-color:#334155}
  .tabs-secondary button{background:transparent;border:none;color:var(--muted);padding:8px 12px;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-10px;transition:color 0.2s, border 0.2s}
  .tabs-secondary button.active{color:var(--accent);border-bottom-color:var(--accent)}
  .deck-card{background:#f9fafb;border:1px solid #e6e9ef;border-radius:10px;padding:14px;margin-bottom:12px;cursor:pointer;transition:all 0.2s}
  [data-theme="dark"] .deck-card{background:#334155;border-color:#475569}
  .deck-card:hover{border-color:var(--accent);background:#f0f4ff}
  [data-theme="dark"] .deck-card:hover{background:rgba(37,99,235,0.15)}
  .deck-card-title{font-weight:700;font-size:16px;margin-bottom:4px;color:var(--text)}
  .deck-card-meta{font-size:12px;color:var(--muted);transition:color 0.3s}
  .deck-card-actions{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}

  .theme-toggle-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--card);
    border: 2px solid var(--accent);
    border-radius: 8px;
    cursor: pointer;
    padding: 0;
    margin-left: 8px;
    color: var(--accent);
    transition: background 0.3s, border 0.3s, color 0.3s;
  }

  .theme-toggle-btn:hover {
    background: var(--accent);
    color: white;
  }

  .theme-icon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .notebook-tabs-container {
    display: flex;
    gap: 2px;
    margin-bottom: -1px;
    position: relative;
    z-index: 10;
  }

  .notebook-tab {
    background: var(--card);
    border: 1px solid #e6e9ef;
    border-bottom: none;
    border-radius: 8px 8px 0 0;
    padding: 12px 20px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    color: var(--muted);
    transition: all 0.2s;
    position: relative;
    transform: perspective(500px) rotateX(5deg);
    transform-origin: bottom;
  }

  [data-theme="dark"] .notebook-tab {
    border-color: #334155;
  }

  .notebook-tab:hover {
    background: #f9fafb;
    color: var(--text);
    transform: perspective(500px) rotateX(2deg);
  }

  [data-theme="dark"] .notebook-tab:hover {
    background: #334155;
  }

  .notebook-tab.active {
    background: linear-gradient(180deg, var(--accent), #2563eb);
    color: white;
    border-color: var(--accent);
    transform: perspective(500px) rotateX(0deg) translateY(1px);
    box-shadow: 0 -2px 8px rgba(37, 99, 235, 0.2);
  }

  .notebook-tab.active:hover {
    background: linear-gradient(180deg, var(--accent), #1d4ed8);
  }

  .notebook-content-wrapper {
    border: 1px solid #e6e9ef;
    border-radius: 0 8px 8px 8px;
    background: var(--card);
    transition: background 0.3s, border 0.3s;
  }

  [data-theme="dark"] .notebook-content-wrapper {
    border-color: #334155;
  }
</style>

<script>
  // ADD THIS AT THE VERY TOP OF YOUR index.html SCRIPT, BEFORE EVERYTHING ELSE
console.log('Index.html script loaded - setting up message listener');

window.addEventListener('message', (event) => {
    console.log('Message received in parent:', event.data);
    if (event.data && event.data.type === 'tilde-pressed') {
        console.log('Tilde pressed detected in parent! Redirecting...');
        window.location.href = "/";
    }
});

// CRITICAL: Set up tilde-pressed listener FIRST, before any other code
window.addEventListener('message', (event) => {
    if (event.data && event.data.type === 'tilde-pressed') {
        console.log('Tilde pressed detected in parent!');
        window.location.href = "/";
    }
});

// Theme Management System
class ThemeManager {
  constructor() {
    this.theme = localStorage.getItem('studybuddy-theme') || 'light';
    this.init();
  }

  init() {
    this.applyTheme(this.theme);
    this.setupButton();
    this.listenForExternalChanges();
  }

  applyTheme(theme) {
    this.theme = theme || 'light';
    document.documentElement.setAttribute('data-theme', this.theme);
    localStorage.setItem('studybuddy-theme', this.theme);
    this.updateButton();
    this.broadcastToIframes();
  }

  toggle() {
    const newTheme = this.theme === 'light' ? 'dark' : 'light';
    this.applyTheme(newTheme);
  }

  setupButton() {
    const btn = document.getElementById('themeToggle');
    if (btn) {
      btn.addEventListener('click', () => this.toggle());
    }
  }

  updateButton() {
    const btn = document.getElementById('themeToggle');
    if (btn) {
      const icon = btn.querySelector('.theme-icon');
      if (icon) {
        icon.innerHTML = this.theme === 'light' 
          ? '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:100%;height:100%"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>'
          : '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:100%;height:100%"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>';
      }
    }
  }

  broadcastToIframes() {
    const iframes = document.querySelectorAll('iframe');
    iframes.forEach(iframe => {
      try {
        iframe.contentWindow.postMessage({
          type: 'THEME_CHANGED',
          theme: this.theme
        }, '*');
      } catch (e) {
        // Silently fail for cross-origin iframes
      }
    });
  }

  listenForExternalChanges() {
    window.addEventListener('message', (event) => {
      if (event.data && event.data.type === 'THEME_CHANGED') {
        this.applyTheme(event.data.theme);
      }
      if (event.data && event.data.type === 'GET_THEME') {
        event.source.postMessage({
          type: 'THEME_CHANGED',
          theme: this.theme
        }, '*');
      }
      if (event.data && event.data.type === 'DECKS_UPDATED') {
        decks = loadDecks();
        renderDeckList();
        if (currentDeckId) {
          currentDeck = decks.find(d => d.id === currentDeckId);
          renderAll();
        }
      }
    });
  }
}

document.addEventListener('DOMContentLoaded', () => {
  new ThemeManager();
});
</script>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">SB</div>
    <div style="flex:1">
      <h1>StudyBuddy</h1>
      <p class="lead">Your personal study companion ‚Äì create flashcards and quizzes, track your progress.</p>
    </div>
    <button id="loginBtn" class="ghost">Login</button>
    <button id="themeToggle" class="theme-toggle-btn" aria-label="Toggle Dark Mode">
      <div class="theme-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:100%;height:100%"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      </div>
    </button>
  </header>

  <div id="loginModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:var(--card);z-index:1000;transition:background 0.3s">
    <iframe id="loginIframe" src="pass.html" style="width:100%;height:100%;border:none"></iframe>
  </div>

  <div class="notebook-tabs-container">
    <div class="notebook-tab active" data-notebook-tab="flashcards">
      <div style="display:flex;align-items:center;gap:6px">
        <span>üìö Flashcards</span>
      </div>
    </div>
    <div class="notebook-tab" data-notebook-tab="notebook">
      <div style="display:flex;align-items:center;gap:6px">
        <span>üìù Notebook</span>
      </div>
    </div>
    <div class="notebook-tab" data-notebook-tab="calculator">
      <div style="display:flex;align-items:center;gap:6px">
        <span>üßÆ Calculator</span>
      </div>
    </div>
  </div>

  <div class="notebook-content-wrapper">
    <iframe id="contentIframe" src="flash.html" style="width:100%;height:800px;border:none;border-radius:0 8px 8px 8px;display:block"></iframe>
  </div>
</div>

<script>
const DECKS_KEY = "studybuddy_decks_v2";

function formatDuration(ms){
  const s = Math.floor(ms/1000);
  const hh = String(Math.floor(s/3600)).padStart(2,"0");
  const mm = String(Math.floor(s%3600/60)).padStart(2,"0");
  const ss = String(s%60).padStart(2,"0");
  return `${hh}:${mm}:${ss}`;
}

function loadDecks(){
  const raw = localStorage.getItem(DECKS_KEY);
  if(!raw) return [];
  try { return JSON.parse(raw); } catch(e){ return []; }
}

function saveDecks(decks){
  localStorage.setItem(DECKS_KEY, JSON.stringify(decks));
}

function generateId(){
  return Date.now().toString(36) + Math.random().toString(36).slice(2);
}

let decks = loadDecks();
let currentDeckId = null;
let currentDeck = null;

(function(){
  const loginModal = document.getElementById("loginModal");
  
  document.getElementById("loginBtn").addEventListener("click", ()=>{
    loginModal.style.display = "block";
  });
  
  window.addEventListener('message', function(event){
    if(event.data === 'closeLogin'){
      loginModal.style.display = "none";
    }
  });
  
  const tabs = document.querySelectorAll('.notebook-tab');
  const contentIframe = document.getElementById('contentIframe');
  
  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      const tabName = this.getAttribute('data-notebook-tab');
      
      tabs.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      if(tabName === 'flashcards') {
        contentIframe.src = 'flash.html';
      } else if(tabName === 'notebook') {
        contentIframe.src = 'notebook.html';
      } else if(tabName === 'calculator') {
        contentIframe.src = 'graph.html';
      }
    });
  });
})();
</script>
</body>
</html>